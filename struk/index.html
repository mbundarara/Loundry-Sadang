<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Loundry Sadang</title>
<style>
  body { font-family: monospace; margin:10px; padding:0; }
  input, button, select, textarea { width:100%; margin:4px 0; font-size:16px; padding:6px; }
  button { cursor:pointer; }
  #strukPreview { white-space: pre; border:1px solid #000; padding:10px; margin-top:10px; }
</style>
</head>
<body>

<h2 style="text-align:center;">Loundry Sadang</h2>

<div id="loginDiv">
  <label>PIN Login:</label>
  <input type="password" id="pin" placeholder="Masukkan PIN">
  <button onclick="login()">Login</button>
  <p id="loginMsg" style="color:red;"></p>
</div>

<div id="formDiv" style="display:none;">
  <label>Nama:</label>
  <input type="text" id="nama">

  <label>No. HP:</label>
  <input type="text" id="nohp">

  <label>Layanan:</label>
  <input type="text" id="layanan">

  <label>Berat (Kg):</label>
  <input type="number" id="berat">

  <label>Total (Rp):</label>
  <input type="number" id="total">

  <label>Catatan:</label>
  <textarea id="catatan"></textarea>

  <button onclick="simpanStruk()">Simpan & Tampilkan Struk</button>

  <pre id="strukPreview"></pre>

  <button onclick="cetakStruk()">Cetak Struk</button>
  <button onclick="kirimWA()">Kirim via WhatsApp</button>
</div>

<script>
const WEBAPP_URL = 'PASTE_URL_EXEC_KAMU'; // ganti pake URL exec Apps Script kamu

function login(){
  const pin = document.getElementById('pin').value;
  fetch(WEBAPP_URL, {
    method:'POST',
    headers:{'Content-Type':'application/x-www-form-urlencoded'},
    body: `action=login&pin=${pin}`
  }).then(r=>r.text()).then(res=>{
    if(res==='ok'){
      document.getElementById('loginDiv').style.display='none';
      document.getElementById('formDiv').style.display='block';
    }else{
      document.getElementById('loginMsg').innerText='PIN salah!';
    }
  });
}

function simpanStruk(){
  const data = {
    nama: document.getElementById('nama').value,
    nohp: document.getElementById('nohp').value,
    total: document.getElementById('total').value,
    catatan: document.getElementById('catatan').value,
    metode: document.getElementById('layanan').value
  };
  
  const body = new URLSearchParams();
  body.append('action','tambah');
  for(let k in data) body.append(k, data[k]);

  fetch(WEBAPP_URL, {method:'POST', body:body})
    .then(r=>r.text())
    .then(noStruk=>{
      const now = new Date();
      const tgl = now.toLocaleString('id-ID',{day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit',second:'2-digit'});
      
      // Tampilkan struk sesuai template final
      const struk = 
`       Loundry Sadang
    Jl. Masjid Baiturohim
      Sadang - Purwasari
--------------------------------
No Struk : ${noStruk}
Tanggal  : ${tgl}
--------------------------------
Nama     : ${data.nama}
No. HP   : ${data.nohp}
Layanan  : ${data.metode}
Berat    : ${document.getElementById('berat').value} Kg
Total    : Rp ${parseInt(data.total).toLocaleString('id-ID')}
Catatan  : ${data.catatan}
--------------------------------
WA / DANA 0851 7219 1936
an : HILMAN FIRMANSYAH`;
      
      document.getElementById('strukPreview').innerText = struk;
    });
}

function cetakStruk(){
  const w = window.open();
  w.document.write('<pre>'+document.getElementById('strukPreview').innerText+'</pre>');
  w.print();
  w.close();
}

function kirimWA(){
  const struk = encodeURIComponent(document.getElementById('strukPreview').innerText);
  const waUrl = `https://wa.me/6285172191936?text=${struk}`;
  window.open(waUrl,'_blank');
}
</script>
</body>
</html>